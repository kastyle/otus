# **Домашняя работа №6**

## **1. Цель работы**

1. Попасть в систему без пароля несколькими способами
2. Установить систему с LVM, после чего переименовать VG
3. Добавить модуль в initrd

**Используемые инструменты:**

- **VirtualBox**- среда виртуализации, позволяет создавать и выполнять виртуальные машины;
- **Vagrant**- ПО для создания и конфигурирования виртуальной среды. В данном случае в качестве среды виртуализации используется VirtualBox;
- **Github**- система контроля версий
- **VSCode**- Удобный редактор кода, со множеством полезных функций;
- Все действия выполнялись под **Ubuntu 18.04.4**

## **2. Часть 1. Сброс пароля**

В начале загрузки системы нажимаем e, что бы иметь возможность менять параметры загрузки.


**Способ №1**
Добавляем в самый конец строки начинающейся с ```linux16 init=/bin/sh``` и нажимаем ```Ctrl + x```. Первым процессом запускается shell и мы можем попасть в систему. Далее, т.к система смонтирована в режиме RO нужно перемонтировать ее в режиме RW: ```mount -o remount,rw /``` . После чего,можно сбрасывать пароль командой passwd. После перезагрузки пароль будет изменен.

**Способ №2**
Добавляем в самый конец строки начинающейся с ```linux16 rd.break и нажимаем Ctrl + x```. Процесс загрузки прерывается перед передачей управления к system.d и система загружается в аварийном режиме. Так же как и в первом случае - режим RO и нужно перемонтироваться в RW + мы находимся не в корне. Исправим эту ситуацию:
```mount -o remount,rw /sysroot
chroot /sysroot
passwd root
touch /.autorelabel
```

Последняя опция запускает autorelabel SELinux после перезагрузки.

**Способ №3**
Способ 3 - то же самое, что и второй, за одним исключением - система сразу находится в RW режиме. Изменяем фрагмент строки начинающийся с linux16 на ```rw init=/sysroot/bin/sh и нажимаем Ctrl + x```. Далее, все так же как в втором способе.
```
chroot /sysroot
passwd root
touch /.autorelabel
```
## **2. Часть 2. Установить систему с LVM, переименовать VG**

Лог работы [можно посмотреть в файле](https://github.com/kastyle/otus/blob/master/HW6/LVM.log).
Смотрим список vg, переименовываем vg, исправляем /etc/fstab, /etc/default/grub, /boot/grub2/grub.cfg , меняя старое название на новое, пересоздаем  init image, reboot. Если все ОК, система поднимется с новым названием vg. ну или не поднимется:) Проверить результат можно командой vgs.

## **3. Часть 3. Добавляем модуль в initrd**

Лог работы [можно посмотреть в файле](https://github.com/kastyle/otus/blob/master/HW6/initrd.log) 
Создаем директорию, в ней создаем 2 скрипта, далее пересобираем образ initrd. После этого редактируем grub (нужно убрать опции rghb и quiet). Перезагружаемся. Если все сделано верно, во время загрузки на 10 секунд появится пингвин.

![dracut](https://github.com/kastyle/otus/blob/master/HW6/screen.png)
